/**
 * 
 */
package de.mbentwicklung.jcrviewer.swing.components;

import javax.swing.JTree;
import javax.swing.event.TreeSelectionEvent;
import javax.swing.event.TreeSelectionListener;
import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.MutableTreeNode;
import javax.swing.tree.TreeSelectionModel;

import de.mbentwicklung.jcrviewer.core.tree.Node;

/**
 * @author Marc Bellmann
 * 
 */
@SuppressWarnings("serial")
public class NodeTree extends JTree {

	private final AttributeTable attributeTable;

	public NodeTree(final Node rootNode, final AttributeTable attributeTable) {
		super(toMutableTreeNode(rootNode));
		
		this.attributeTable = attributeTable;
		
		getSelectionModel().setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);
		addTreeSelectionListener();
	}
	
	public void addTreeSelectionListener() {
		super.addTreeSelectionListener(new TreeSelectionListener() {
			
			public void valueChanged(TreeSelectionEvent e) {
				if (getLastSelectedPathComponent() instanceof DefaultMutableTreeNode) {
					DefaultMutableTreeNode mutableTreeNode = (DefaultMutableTreeNode) getLastSelectedPathComponent();
					if (mutableTreeNode.getUserObject() instanceof Node) {
						Node node = (Node) mutableTreeNode.getUserObject();
						attributeTable.updateTable(node);
					}
				}
			}
		});
	}
	
	private static MutableTreeNode toMutableTreeNode(final Node rootNode) {
		DefaultMutableTreeNode tree = new DefaultMutableTreeNode(rootNode,
				!rootNode.getChildren().isEmpty());

		for (Node childNode : rootNode.getChildren()) {
			tree.add(toMutableTreeNode(childNode));
		}

		return tree;
	}
}
